const speech = require('@google-cloud/speech');

exports.transcribe = function(audioFile, response)
{
    const client = new speech.SpeechClient();
    var transcription = "naught"; //Construct from available data (origin / data / output / date / processTime / confidence)
    var confidence = "naught"; //Percentage of confidence in transcription

    setTimeout(function()
    {
        transcription = "toto";
        confidence = "high"
    }, 2000);

    // const config =
    // {
    //     encoding: 'FLAC',
    //     audioChannelCount: 1,
    //     languageCode: 'fr-FR',
    //     model: 'command_and_search'
    // };
    
    // const audio = 
    // {
    //     content: fs.readFileSync(audioFile.path)
    // };

    // const req =
    // {
    //     audio: audio,
    //     config: config,
    // };

    // client
    //     .recognize(req)
    //     .then(data =>
    //     {
    //         const response = data[0];
    //         transcription = response.results
    //             .map(result => result.alternatives[0].transcript)
    //             .join('\n');
    //         confidence = response.results
    //             .map(result => result.alternatives[0].confidence)
    //             .join('\n');
    //         console.log("Transcription: " + transcription);
    //         console.log("Confidence: " + confidence);
    //     })
    //     .catch(err =>
    //     {
    //         console.error('ERROR:', err);
    //     });

    response.send(transcription);

    var res = {"transcription": transcription, "confidence": confidence};

    return res;
}